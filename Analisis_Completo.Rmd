---
title: 'ANÁLISIS ESPACIAL DE SISMOS EN LOS CANTONES DE COSTA RICA DURANTE EL PERIODO 2010-2022'
author:
- 'Camila Aguilar'
- 'Brenda Fonseca'
- 'Héctor Ramírez'
date: "Noviembre 2023"
output: html_document
editor_options: 
  chunk_output_type: console
---


```{r}
library(readxl)
library(dplyr)
library(lubridate)
library(stringr)
library(car)
```


```{r}
###Lectura de datos
datos <- read_excel("Datos/sismos_cr.xlsx")
```


```{r}
###Seleccionar solo las variables necesarias y renombrar algunas
datos2 <- datos %>% 
  dplyr::select(time, latitude, longitude,  PC, canton, descrp., mag, magError) %>% 
  rename(lon = longitude,
         lat = latitude,
         lugar = descrp.)
```


```{r}
##Dejar la fecha en la zona horaria para CR
datos2$fecha <- with_tz(datos2$time, tzone = "America/Costa_Rica")
```

```{r}
###Seleccionar variables
datos2 <- datos2 %>% 
  dplyr::select(fecha, lat:magError)
```



```{r}
###Crear variables de tiempo
datos2 <- datos2 |> mutate(
  anio = stringr::str_sub(fecha,1,4),
  mes = substr(as.character(fecha),6,7),
  dia = substr(as.character(fecha),9,10),
  fecha2 = as.Date(fecha))
```


```{r}
###Seleccionar variables
datos2 <- datos2 %>% 
  dplyr::select(fecha, fecha2, anio:dia, lat:magError)
```

```{r}
#### Trabajar solo con los sismos mayores a 2.9 (3 o más de magnitud)
datos2 <- datos2 %>% 
  filter(mag > 2.9)
```



```{r}
###Crear variable de clasificación para la magnitud
datos2$clas_n <- car::recode(datos2$mag,
                             "0=1; 3:3.9 = 2; 4:4.9=3; 5:5.9=4; 6:6.9=5; 7:7.9=6")

datos2$clas <- as.factor(datos2$clas_n)

levels(datos2$clas) <- c("Muy ligera", "Ligera", "Moderada", "Fuerte", "Muy fuerte")
```



```{r}
###Generar los conteos (variable de interés) por cantón
datos3 <- datos2 %>% 
  group_by(PC, canton) %>% 
  summarise(cantidad = n(),
            mag_prom = mean(mag))

###Crear variable de clasificación para la magnitud
datos3$clas_n <- car::recode(datos3$mag_prom,
                             "3:3.9999999999999 = 1; 4:4.9=2; 5:5.9=3; 6:6.9=4; 7:7.9=5")
datos3$clas <- as.factor(datos3$clas_n)

levels(datos3$clas) <- c("Muy ligera", "Ligera", "Moderada", "Fuerte", "Muy fuerte")
```
